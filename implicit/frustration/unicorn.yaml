graphs:
  - id: Broker
    nodes:
      - id: proxy
        module: timeflux.nodes.zmq
        class: Broker

  - id: EEG
    nodes:
      - id: eeg
        module: timeflux_brainflow.nodes.driver
        class: BrainFlow
        params:
          board: unicorn
      - id: pub_eeg
        module: timeflux.nodes.zmq
        class: Pub
        params:
          topic: eeg
      - id: reindex
        module: timeflux.nodes.dejitter
        class: Reindex
        params:
          rate: 250
    edges:
      - source: eeg
        target: reindex
      - source: reindex
        target: pub_eeg
    rate: 5

  - id: UI
    nodes:
      - id: engine
        module: timeflux_ui.nodes.ui
        class: UI
        params:
          routes:
            engine: gui
          settings:
            grid:
              grid:
                rows: 4
                columns: 4
            engine:
              durations:
                step: 1000
                new_grid: 2000
              keys:
                activate: true
                good: b
                bad: v
              sessions: 30
              max_step: 15
      - id: sub
        module: timeflux.nodes.zmq
        class: Sub
        params:
          topics: [model, eeg]
      - id: pub
        module: timeflux.nodes.zmq
        class: Pub
        params:
          topic: events
      - id: bp_filter
        module: timeflux_dsp.nodes.filters
        class: IIRFilter
        params:
          frequencies: [0.1, 40]
    edges:
      - source: engine:events
        target: pub
      - source: sub:model
        target: engine:model
      - source: sub:eeg
        target: engine:eeg
      - source: sub:eeg
        target: bp_filter
      - source: bp_filter
        target: engine:filtered_eeg

  - id: Record
    nodes:
      - id: sub
        module: timeflux.nodes.zmq
        class: Sub
        params:
          topics: [events, eeg]
      - id: save
        module: timeflux.nodes.hdf5
        class: Save
        params:
          path: data
          complevel: 0
          min_itemsize: 200
      - id: debug
        module: timeflux.nodes.debug
        class: Display
    edges:
      - source: sub:events
        target: save:events
      - source: sub:eeg
        target: save:eeg
      - source: sub:events
        target: debug
